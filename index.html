<!doctype html>
<html lang="es">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>PABOSCONNECT â€” Foro acadÃ©mico (Forest theme)</title>
Â  <style>
Â  Â  :root{
Â  Â  Â  --bg-light: #f3efe6;Â  Â  Â  Â /* claro: cafÃ© muy suave */
Â  Â  Â  --card-light: #fffefc;
Â  Â  Â  --text-light: #2b2119;Â  Â  /* cafÃ© oscuro para texto */
Â  Â  Â  --accent-green: #2f8f5a;Â  /* verde acento */
Â  Â  Â  --accent-brown: #8b5e3c;Â  /* cafÃ© acento */
Â  Â  Â  --muted: #6b6b68;
Â  Â  Â  --glass: rgba(255,255,255,0.7);
Â  Â  }

Â  Â  /* Dark (forest): cafÃ© oscuro fondo + acentos verdes) */
Â  Â  .dark {
Â  Â  Â  --bg-light: #1e1410;Â  Â  Â  /* fondo oscuro cafe */
Â  Â  Â  --card-light: #241815;Â  Â  /* tarjeta cafe oscuro */
Â  Â  Â  --text-light: #e9eadf;Â  Â  /* texto claro */
Â  Â  Â  --accent-green: #62c78b;
Â  Â  Â  --accent-brown: #a8794f;
Â  Â  Â  --muted: #9a8f87;
Â  Â  Â  --glass: rgba(255,255,255,0.03);
Â  Â  }

    /* === [NUEVO] Filtros de Accesibilidad (Daltonismo) === */
        
    /* --- Protanopia / Deuteranopia (Rojo/Verde) --- */
    /* Cambia Verde -> Azul, CafÃ© -> Naranja */
    
    html[data-cbf="protan"],
    html[data-cbf="deutan"] {
      --accent-green: #007bff; /* Azul */
      --accent-brown: #fd7e14; /* Naranja */
    }
    
    html[data-cbf="protan"] .votes,
    html[data-cbf="deutan"] .votes {
      background: rgba(0, 123, 255, 0.06); /* Fondo Votos Azul */
      border-color: rgba(0, 123, 255, 0.06);
    }
    
    html[data-cbf="protan"] .tag,
    html[data-cbf="deutan"] .tag {
      background: rgba(0, 123, 255, 0.08); /* Fondo Tag Azul */
    }
    
    /* Dark Mode - Protan/Deutan */
    html[data-cbf="protan"].dark,
    html[data-cbf="deutan"].dark {
      --accent-green: #58a6ff; /* Azul claro */
      --accent-brown: #f0883e; /* Naranja claro */
    }

    /* --- Tritanopia (Azul/Amarillo) --- */
    /* Cambia Verde -> Cian, CafÃ© -> Rojo */
    
    html[data-cbf="tritan"] {
      --accent-green: #17a2b8; /* Cian */
      --accent-brown: #d73a49; /* Rojo */
    }
    
    html[data-cbf="tritan"] .votes {
      background: rgba(23, 162, 184, 0.06); /* Fondo Votos Cian */
      border-color: rgba(23, 162, 184, 0.06);
    }
    
    html[data-cbf="tritan"] .tag {
      background: rgba(23, 162, 184, 0.08); /* Fondo Tag Cian */
    }
    
    /* Dark Mode - Tritan */
    html[data-cbf="tritan"].dark {
      --accent-green: #61dafb; /* Cian claro */
      --accent-brown: #f85149; /* Rojo claro */
    }
    /* === FIN [NUEVO] === */


Â  Â  html,body{height:100%;margin:0;background:var(--bg-light);color:var(--text-light);font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
Â  Â  .app{max-width:1100px;margin:24px auto;padding:18px}
Â  Â  header{display:flex;align-items:center;justify-content:space-between;gap:12px;background:var(--card-light);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
Â  Â  .brand{display:flex;align-items:center;gap:12px}
Â  Â  .logo{height:56px;width:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden;background:transparent;border:2px solid rgba(0,0,0,0.04)}
Â  Â  .logo img{height:56px;width:auto;display:block}
Â  Â  h1{margin:0;font-size:20px}
Â  Â  p.lead{margin:0;color:var(--muted);font-size:13px}

Â  Â  .top-actions{display:flex;gap:8px;align-items:center}
Â  Â  .btn{background:var(--accent-green);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
Â  Â  .btn.ghost{background:transparent;color:var(--accent-brown);border:2px solid var(--accent-brown)}
Â  Â  .search{display:flex;align-items:center;gap:8px;background:var(--card-light);padding:6px 8px;border-radius:999px;border:1px solid rgba(0,0,0,0.04)}
Â  Â  input.search-in{border:0;outline:0;padding:6px;min-width:220px;background:transparent;color:var(--text-light)}

Â  Â  main{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}

Â  Â  .card{background:var(--card-light);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04);border:1px solid rgba(0,0,0,0.03)}
Â  Â  .profile{display:flex;gap:12px;align-items:center}
Â  Â  .avatar{width:64px;height:64px;border-radius:10px;background:linear-gradient(180deg,#cfc1b7,#fff);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent-brown)}
Â  Â  .meta small{color:var(--muted)}
Â  Â  .categories{margin-top:12px;display:flex;flex-direction:column;gap:8px}
Â  Â  .cat{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
Â  Â  .cat:hover{background:rgba(0,0,0,0.02)}

Â  Â  .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
Â  Â  .threads{display:flex;flex-direction:column;gap:12px}
Â  Â  .thread{display:flex;gap:12px;padding:14px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);align-items:flex-start;background:var(--card-light)}
Â  Â  .votes{width:56px;display:flex;flex-direction:column;align-items:center;padding:6px;border-radius:8px;background:rgba(47,143,90,0.06);border:1px solid rgba(47,143,90,0.06)}
Â  Â  .votes button{background:transparent;border:0;cursor:pointer;font-weight:700;color:var(--accent-green)}
Â  Â  .thread-content{flex:1}
Â  Â  .thread-title{font-weight:700;margin:0}
Â  Â  .thread-meta{color:var(--muted);font-size:13px}
Â  Â  .tags{display:flex;gap:6px;margin-top:8px}
Â  Â  .tag{background:rgba(47,143,90,0.08);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--accent-green)}

Â  Â  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

Â  Â  .modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:60}
Â  Â  .modal{width:100%;max-width:720px;background:var(--card-light);border-radius:12px;padding:16px}
Â  Â  .form-row{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}
Â  Â  textarea{min-height:100px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--text-light)}
Â  Â  input[type=text],select{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--text-light)}

Â  Â  .read-btn{background:transparent;border:0;cursor:pointer;color:var(--accent-brown);font-weight:700;padding:6px;border-radius:6px}

Â  Â  @media(max-width:900px){main{grid-template-columns:1fr} .logo{display:none}}

Â  Â  /* Dark tweaks */
Â  Â  .dark header{background:var(--card-light);box-shadow:none}
Â  Â  .dark .card{box-shadow:none;border:1px solid rgba(255,255,255,0.03)}
Â  Â  .dark input, .dark textarea, .dark select{background:#36251f;color:var(--text-light);border:1px solid rgba(255,255,255,0.06)}
Â  </style>
</head>
<body>
Â  <div class="app">
Â  Â  <header>
Â  Â  Â  <div class="brand">
Â  Â  Â  Â  <div class="logo" title="Logo Foro de Pabos">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="siteLogo" alt="logo pavo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HwAF/wJ+e0rVAAAAAElFTkSuQmCC" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h1 id="siteTitle">PABOSCONNECT</h1>
Â  Â  Â  Â  Â  <p class="lead">Foro acadÃ©mico â€” InteracciÃ³n Humano-Computadora (UACJ)</p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="top-actions">
Â  Â  Â  Â  <div class="search card" style="display:flex;align-items:center">
Â  Â  Â  Â  Â  <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#6b7280" d="M9.5 3a6.5 6.5 0 1 1 0 13 6.5 6.5 0 0 1 0-13zm0 2a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9zM20.7 20.3 16 15.6"/></svg>
sÂ  Â  Â  Â  Â  <input id="searchBox" class="search-in" placeholder="Buscar temas, materias, autores..." />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="btn" id="newThreadBtn">+ Crear tema</button>
Â  Â  Â  Â  <button class="btn ghost" id="loginBtn">Iniciar sesiÃ³n</button>
Â  Â  Â  Â  <button class="btn ghost" id="themeToggle" title="Cambiar tema">ðŸŒ™</button>
        Â  Â  Â  Â  <button class="btn ghost" id="a11yFilterBtn" title="Cambiar filtro de color">ðŸŽ¨</button>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main>
Â  Â  Â  <aside>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <div class="profile">
Â  Â  Â  Â  Â  Â  <div class="avatar" id="avatarLetter">G</div>
Â  Â  Â  Â  Â  Â  <div class="meta">
Â  Â  Â  Â  Â  Â  Â  <div id="userName">Invitado</div>
Â  Â  Â  Â  Â  Â  Â  <small id="userSub">Sin sesiÃ³n</small>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="margin-top:12px;display:flex;gap:8px">
Â  Â  Â  Â  Â  Â  <button class="btn" id="myProfileBtn">Mi perfil</button>
Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="logoutBtn" style="display:none">Cerrar</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="categories" style="margin-top:12px">
Â  Â  Â  Â  Â  Â  <div><strong>CategorÃ­as</strong></div>
Â  Â  Â  Â  Â  Â  <div class="cat" data-cat="all">Todos</div>
Â  Â  Â  Â  Â  Â  <div class="cat" data-cat="General">General <small style="color:var(--muted)"> â€“ charla</small></div>
Â  Â  Â  Â  Â  Â  <div class="cat" data-cat="Materias">Materias <small style="color:var(--muted)"> â€“ dudas</small></div>
Â  Â  Â  Â  Â  Â  <div class="cat" data-cat="Recursos">Recursos <small style="color:var(--muted)"> â€“ apuntes</small></div>
Â  Â  Â  Â  Â  Â  <div class="cat" data-cat="Tutorias">TutorÃ­as <small style="color:var(--muted)"> â€“ ayuda</small></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card" style="margin-top:12px">
Â  Â  Â  Â  Â  <strong>Top colaboradores</strong>
Â  Â  Â  Â  Â  <ul id="topList" style="padding-left:16px;margin-top:8px;color:var(--muted)"></ul>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>

Â  Â  Â  <section>
Â  Â  Â  Â  <div class="toolbar">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <strong id="currentFilter">Todos los temas</strong>
Â  Â  Â  Â  Â  Â  <div style="color:var(--muted);font-size:13px">Filtra por categorÃ­a o busca palabras clave</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="display:flex;gap:8px;align-items:center">
Â  Â  Â  Â  Â  Â  <select id="sortSelect">
Â  Â  Â  Â  Â  Â  Â  <option value="new">MÃ¡s recientes</option>
Â  Â  Â  Â  Â  Â  Â  <option value="top">MÃ¡s votados</option>
Â  Â  Â  Â  Â  Â  Â  <option value="answered">MÃ¡s respondidos</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="threads" id="threadsList"></div>

Â  Â  Â  Â  <footer>
Â  Â  Â  Â  Â  Prototipo â€” PABOSCONNECT Â· Foro acadÃ©mico para la UACJ Â· (Frontend sin back-end, datos guardados en tu navegador)
Â  Â  Â  Â  </footer>
Â  Â  Â  </section>
Â  Â  </main>
Â  </div>

Â  Â  <div class="modal-back" id="modalNew">
Â  Â  <div class="modal">
Â  Â  Â  <h3>Crear nuevo tema</h3>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label>TÃ­tulo</label>
Â  Â  Â  Â  <input id="threadTitle" type="text" placeholder="Pregunta o tema (ej: Duda de CÃ¡lculo II)">
Â  Â  Â  </div>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label>CategorÃ­a</label>
Â  Â  Â  Â  <select id="threadCategory"><option>General</option><option>Materias</option><option>Recursos</option><option>Tutorias</option></select>
Â  Â  Â  </div>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label>Contenido</label>
Â  Â  Â  Â  <textarea id="threadBody" placeholder="Explica tu duda o comparte el recurso..."></textarea>
Â  Â  Â  </div>
Â  Â  Â  <div style="display:flex;gap:8px;justify-content:flex-end">
Â  Â  Â  Â  <button class="btn ghost" id="closeNew">Cancelar</button>
Â  Â  Â  Â  <button class="btn" id="publishBtn">Publicar</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="modal-back" id="modalLogin">
Â  Â  <div class="modal">
Â  Â  Â  <h3>Iniciar sesiÃ³n (simulado)</h3>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label>Nombre</label>
Â  Â  Â  Â  <input id="loginName" type="text" placeholder="Tu nombre (ej: Carol Abril)">
Â  Â  Â  </div>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label>Carrera</label>
Â  Â  Â  Â  <input id="loginMajor" type="text" placeholder="Tu carrera (ej: IngenierÃ­a)" />
Â  Â  Â  </div>
Â  Â  Â  <div style="display:flex;gap:8px;justify-content:flex-end">
Â  Â  Â  Â  <button class="btn ghost" id="closeLogin">Cancelar</button>
Â  Â  Â  Â  <button class="btn" id="doLogin">Ingresar</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="modal-back" id="modalView">
Â  Â  <div class="modal" id="viewModalContent"></div>
Â  </div>

Â  <script>
Â  Â  // ===== keys =====
Â  Â  const STORAGE_KEY = 'pabos_forum_forest_v1';
Â  Â  const THEME_KEY = 'pabos_theme_forest_v1';
Â  Â  const SESSION_KEY = 'pabos_session_v1';
    const A11Y_KEY = 'pabos_a11y_filter_v1'; /* === [NUEVO] Key para filtro A11y === */

Â  Â  // ===== sample data (guardados si no hay localStorage) =====
Â  Â  const sample = {
Â  Â  Â  users: [
Â  Â  Â  Â  {id: 'u1', name: 'Brian H.', major:'Ing. Sistemas', reputation: 38},
Â  Â  Â  Â  {id: 'u2', name: 'Mariana P.', major:'DiseÃ±o', reputation: 22},
Â  Â  Â  Â  {id: 'u3', name: 'Carol Abril', major:'PsicologÃ­a', reputation: 55}
Â  Â  Â  ],
Â  Â  Â  threads: [
Â  Â  Â  Â  {id:'t1',title:'Â¿QuÃ© opinan del nuevo mÃ³dulo?',category:'General',authorId:'u1',body:'Creo que el nuevo mÃ³dulo estÃ¡ bien diseÃ±ado, aunque algunos temas son algo pesados.',votes:5,created:Date.now()-1000*60*60*24*3,replies:[{id:'r1',authorId:'u2',body:'Yo creo que con prÃ¡cticas se entiende.',created:Date.now()-1000*60*60*24*2}]},
Â  Â  Â  Â  {id:'t2',title:'Consejos para estadÃ­stica',category:'Materias',authorId:'u3',body:'Revisen bien los conceptos de probabilidad y practiquen muchos ejercicios.',votes:6,created:Date.now()-1000*60*60*24*1,replies:[]}
Â  Â  Â  ]
Â  Â  };

Â  Â  // ===== load/save =====
Â  Â  function loadDB(){
Â  Â  Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  Â  Â  if(raw) return JSON.parse(raw);
Â  Â  Â  localStorage.setItem(STORAGE_KEY, JSON.stringify(sample));
Â  Â  Â  return JSON.parse(JSON.stringify(sample));
Â  Â  }
Â  Â  let db = loadDB();

Â  Â  // session (persistente)
Â  Â  function loadSession(){
Â  Â  Â  const s = localStorage.getItem(SESSION_KEY);
Â  Â  Â  return s ? JSON.parse(s) : null;
Â  Â  }
Â  Â  let sessionUser = loadSession();

Â  Â  // theme
Â  Â  function initTheme(){
Â  Â  Â  const saved = localStorage.getItem(THEME_KEY);
Â  Â  Â  if(saved === 'dark'){ document.documentElement.classList.add('dark'); document.getElementById('themeToggle').textContent = 'â˜€ï¸'; }
Â  Â  Â  else { document.documentElement.classList.remove('dark'); document.getElementById('themeToggle').textContent = 'ðŸŒ™'; }
Â  Â  }

    /* === [NUEVO] Inicializar filtro A11y === */
    function initA11yFilter(){
      const saved = localStorage.getItem(A11Y_KEY);
      if(saved){
        document.documentElement.dataset.cbf = saved;
        byId('a11yFilterBtn').textContent = saved.charAt(0).toUpperCase();
        byId('a11yFilterBtn').title = `Filtro actual: ${saved}`;
      }
    }

Â  Â  const byId = id => document.getElementById(id);

Â  Â  // ===== render top collaborators =====
Â  Â  function renderTop(){
Â  Â  Â  const ul = byId('topList'); ul.innerHTML = '';
Â  Â  Â  const users = [...db.users].sort((a,b)=>b.reputation-a.reputation).slice(0,6);
Â  Â  Â  users.forEach(u=>{
Â  Â  Â  Â  const li=document.createElement('li'); li.textContent = `${u.name} â€” ${u.reputation} pts`; ul.appendChild(li);
Â  Â  Â  });
Â  Â  }

Â  Â  // ===== render threads list =====
Â  Â  function renderThreads(filter='all', q=''){
Â  Â  Â  const container = byId('threadsList'); container.innerHTML = '';
Â  Â  Â  let threads = db.threads.slice();
Â  Â  Â  const sort = byId('sortSelect').value;
Â  Â  Â  if(filter && filter!=='all') threads = threads.filter(t=>t.category===filter);
Â  Â  Â  if(q) threads = threads.filter(t=> (t.title + ' ' + t.body).toLowerCase().includes(q.toLowerCase()));
Â  Â  Â  if(sort==='new') threads.sort((a,b)=>b.created-a.created);
Â  Â  Â  if(sort==='top') threads.sort((a,b)=> (b.votes - a.votes) || (b.created - a.created));
Â  Â  Â  if(sort==='answered') threads.sort((a,b)=> (b.replies.length - a.replies.length) || (b.created - a.created));

Â  Â  Â  threads.forEach(t=>{
Â  Â  Â  Â  const el = document.createElement('div'); el.className='thread';
Â  Â  Â  Â  const preview = escapeHtml(t.body.slice(0,240)) + (t.body.length>240 ? '...' : '');
Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  <div class="votes">
Â  Â  Â  Â  Â  Â  <button class="up" data-id="${t.id}">â–²</button>
Â  Â  Â  Â  Â  Â  <div style="font-size:14px;font-weight:700">${t.votes}</div>
Â  Â  Â  Â  Â  Â  <button class="down" data-id="${t.id}">â–¼</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="thread-content">
Â  Â  Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:flex-start">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="thread-title">${escapeHtml(t.title)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="thread-meta">Publicado por ${getUserName(t.authorId)} Â· ${timeAgo(t.created)} Â· <span style="color:var(--muted)">${t.replies.length} respuestas</span></div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="tags"><div class="tag">${escapeHtml(t.category)}</div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="margin-top:8px;color:var(--muted);font-size:14px">${preview}</div>
Â  Â  Â  Â  Â  Â  <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
Â  Â  Â  Â  Â  Â  Â  <button class="btn ghost viewBtn" data-id="${t.id}">Ver tema</button>
Â  Â  Â  Â  Â  Â  Â  <button class="read-btn" data-id="${t.id}" data-type="preview">ðŸ”Š Leer</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  container.appendChild(el);
Â  Â  Â  });

Â  Â  Â  // events
Â  Â  Â  document.querySelectorAll('.up').forEach(b=>b.onclick = e=>voteThread(e.currentTarget.dataset.id,1));
Â  Â  Â  document.querySelectorAll('.down').forEach(b=>b.onclick = e=>voteThread(e.currentTarget.dataset.id,-1));
Â  Â  Â  document.querySelectorAll('.viewBtn').forEach(b=>b.onclick = e=>openThread(e.currentTarget.dataset.id));
Â  Â  Â  document.querySelectorAll('.read-btn').forEach(b=>b.onclick = e=>{
Â  Â  Â  Â  const id = e.currentTarget.dataset.id;
Â  Â  Â  Â  const t = db.threads.find(x=>x.id===id);
Â  Â  Â  Â  if(!t) return;
Â  Â  Â  Â  speak(`${t.title}. ${t.body}`);
Â  Â  Â  });
Â  Â  }

Â  Â  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
Â  Â  function getUserName(id){ const u = db.users.find(x=>x.id===id); return u?u.name:'Invitado'; }
Â  Â  function timeAgo(ts){ const s = Math.floor((Date.now()-ts)/1000); if(s<60) return s+'s'; if(s<3600) return Math.floor(s/60)+'m'; if(s<86400) return Math.floor(s/3600)+'h'; return Math.floor(s/86400)+'d'; }

Â  Â  function voteThread(id,delta){
Â  Â  Â  const t = db.threads.find(x=>x.id===id); if(!t) return;
Â  Â  Â  t.votes = (t.votes||0) + delta;
Â  Â  Â  saveDB(); renderThreads(currentFilter, byId('searchBox').value); renderTop();
Â  Â  }

Â  Â  function openThread(id){
Â  Â  Â  const t = db.threads.find(x=>x.id===id); if(!t) return;
Â  Â  Â  const modal = byId('modalView'); modal.style.display='flex';
Â  Â  Â  const box = byId('viewModalContent'); box.innerHTML = '';
Â  Â  Â  const author = getUserName(t.authorId);

Â  Â  Â  const html = document.createElement('div');
Â  Â  Â  html.innerHTML = `
Â  Â  Â  Â  <h3>${escapeHtml(t.title)}</h3>
Â  Â  Â  Â  <div style="color:var(--muted);font-size:13px">Por ${author} Â· ${timeAgo(t.created)} Â· ${t.votes} votos</div>
Â  Â  Â  Â  <div style="margin-top:8px"><button class="read-btn" id="readThreadFull">ðŸ”Š Leer tema completo</button></div>
Â  Â  Â  Â  <hr style="margin:12px 0">
Â  Â  Â  Â  <div style="white-space:pre-wrap">${escapeHtml(t.body)}</div>
Â  Â  Â  Â  <hr style="margin:12px 0">
Â  Â  Â  Â  <strong>Respuestas (${t.replies.length})</strong>
Â  Â  Â  Â  <div id="repliesBox" style="margin-top:8px"></div>
Â  Â  Â  Â  <div style="margin-top:12px">
Â  Â  Â  Â  Â  <textarea id="replyText" placeholder="Escribe tu respuesta..."></textarea>
Â  Â  Â  Â  Â  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
Â  Â  Â  Â  Â  Â  <button class="btn ghost" id="closeView">Cerrar</button>
Â  Â  Â  Â  Â  Â  <button class="btn" id="publishReply">Responder</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  Â  box.appendChild(html);

Â  Â  Â  const repliesBox = box.querySelector('#repliesBox');
Â  Â  Â  t.replies.forEach(r=>{
Â  Â  Â  Â  const u = getUserName(r.authorId);
Â  Â  Â  Â  const d = document.createElement('div');
Â  Â  Â  Â  d.style.padding='8px'; d.style.borderRadius='8px'; d.style.border='1px solid rgba(0,0,0,0.04)'; d.style.marginTop='8px';
Â  Â  Â  Â  d.innerHTML = `<div style="font-weight:700">${escapeHtml(u)} <small style="color:var(--muted);font-weight:400">Â· ${timeAgo(r.created)}</small></div><div style="margin-top:6px">${escapeHtml(r.body)}</div><div style="margin-top:6px"><button class="read-btn reply-read" data-id="${r.id}">ðŸ”Š Leer respuesta</button></div>`;
Â  Â  Â  Â  repliesBox.appendChild(d);
Â  Â  Â  });

Â  Â  Â  box.querySelector('#closeView').onclick = ()=>{ modal.style.display='none'; }
Â  Â  Â  box.querySelector('#publishReply').onclick = ()=>{
Â  Â  Â  Â  const text = box.querySelector('#replyText').value.trim(); if(!text){ alert('Escribe algo para responder'); return }
Â  Â  Â  Â  const rid = 'r'+Math.random().toString(36).slice(2,9);
Â  Â  Â  Â  const authorId = sessionUser?sessionUser.id:'guest';
Â  Â  Â  Â  const reply = {id:rid,authorId,body:text,created:Date.now()};
Â  Â  Â  Â  t.replies.push(reply);
Â  Â  Â  Â  const u = db.users.find(x=>x.id===authorId); if(u) u.reputation += 2;
Â  Â  Â  Â  saveDB(); renderTop(); openThread(id); // re-open refreshed
Â  Â  Â  }

Â  Â  Â  box.querySelector('#readThreadFull').onclick = ()=> speak(`${t.title}. ${t.body}. Respuestas: ${t.replies.length}`);
Â  Â  Â  box.querySelectorAll('.reply-read').forEach(b=>{
Â  Â  Â  Â  b.onclick = e=>{
Â  Â  Â  Â  Â  const rid = e.currentTarget.dataset.id;
Â  Â  Â  Â  Â  const r = t.replies.find(x=>x.id===rid);
Â  Â  Â  Â  Â  if(r) speak(`${getUserName(r.authorId)} dijo: ${r.body}`);
Â  Â  Â  Â  };
Â  Â  Â  });
Â  Â  }

Â  Â  function saveDB(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }
Â  Â  function saveSession(){ localStorage.setItem(SESSION_KEY, JSON.stringify(sessionUser)); }

Â  Â  // ===== events UI =====
Â  Â  byId('newThreadBtn').onclick = ()=>{ if(!sessionUser){ alert('Necesitas iniciar sesiÃ³n para crear temas.'); return } byId('modalNew').style.display='flex'; }
Â  Â  byId('closeNew').onclick = ()=> byId('modalNew').style.display='none';
Â  Â  byId('publishBtn').onclick = ()=>{
Â  Â  Â  const title = byId('threadTitle').value.trim();
Â  Â  Â  const body = byId('threadBody').value.trim();
Â  Â  Â  const cat = byId('threadCategory').value;
Â  Â  Â  if(!title || !body){ alert('Completa tÃ­tulo y contenido'); return }
Â  Â  Â  const id = 't'+Math.random().toString(36).slice(2,9);
Â  Â  Â  db.threads.push({id,title,category:cat,authorId:sessionUser.id,body,votes:0,created:Date.now(),replies:[]});
Â  Â  Â  const me = db.users.find(x=>x.id===sessionUser.id); if(me) me.reputation = (me.reputation||0)+3;
Â  Â  Â  saveDB();
Â  Â  Â  byId('modalNew').style.display='none';
Â  Â  Â  byId('threadTitle').value=''; byId('threadBody').value='';
Â  Â  Â  renderThreads(currentFilter, byId('searchBox').value); renderTop();
Â  Â  }

Â  Â  // login
Â  Â  byId('loginBtn').onclick = ()=> byId('modalLogin').style.display='flex';
Â  Â  byId('closeLogin').onclick = ()=> byId('modalLogin').style.display='none';
Â  Â  byId('doLogin').onclick = ()=>{
Â  Â  Â  const name = byId('loginName').value.trim(); const major = byId('loginMajor').value.trim();
Â  Â  Â  if(!name){ alert('Escribe tu nombre'); return }
Â  Â  Â  let user = db.users.find(u=>u.name.toLowerCase()===name.toLowerCase());
Â  Â  Â  if(!user){ user = {id:'u'+Math.random().toString(36).slice(2,6), name, major:major||'â€”', reputation:5}; db.users.push(user); }
Â  Â  Â  sessionUser = user;
Â  Â  Â  saveDB(); saveSession(); updateSessionUI();
Â  Â  Â  byId('modalLogin').style.display='none';
Â  Â  }
Â  Â  byId('logoutBtn').onclick = ()=>{ sessionUser=null; localStorage.removeItem(SESSION_KEY); updateSessionUI(); }

Â  Â  function updateSessionUI(){Â 
Â  Â  Â  if(sessionUser){
Â  Â  Â  Â  byId('userName').textContent = sessionUser.name;Â 
Â  Â  Â  Â  byId('userSub').textContent = sessionUser.major || '';
Â  Â  Â  Â  byId('avatarLetter').textContent = sessionUser.name.slice(0,1).toUpperCase();
Â  Â  Â  Â  byId('loginBtn').style.display='none'; byId('logoutBtn').style.display='inline-block';
Â  Â  Â  } else {
Â  Â  Â  Â  byId('userName').textContent='Invitado'; byId('userSub').textContent='Sin sesiÃ³n'; byId('avatarLetter').textContent='G';
Â  Â  Â  Â  byId('loginBtn').style.display='inline-block'; byId('logoutBtn').style.display='none';
Â  Â  Â  }
Â  Â  }

Â  Â  // categories filter
Â  Â  document.querySelectorAll('.cat').forEach(c=>c.onclick = e=>{
Â  Â  Â  const cat = e.currentTarget.dataset.cat;
Â  Â  Â  byId('currentFilter').textContent = cat==='all' ? 'Todos los temas' : cat;
Â  Â  Â  currentFilter = cat==='all' ? 'all' : cat;
Â  Â  Â  renderThreads(currentFilter, byId('searchBox').value);
Â  Â  });

Â  Â  byId('sortSelect').onchange = ()=>renderThreads(currentFilter, byId('searchBox').value);
Â  Â  byId('searchBox').oninput = ()=>renderThreads(currentFilter, byId('searchBox').value);

Â  Â  // profile btn
Â  Â  byId('myProfileBtn').onclick = ()=>{
Â  Â  Â  if(!sessionUser){ alert('Inicia sesiÃ³n para ver tu perfil'); return }
Â  Â  Â  const modal = byId('modalView'); modal.style.display='flex'; const box = byId('viewModalContent');
Â  Â  Â  const userThreads = db.threads.filter(t=>t.authorId===sessionUser.id);
Â  Â  Â  box.innerHTML = `<h3>Perfil â€” ${escapeHtml(sessionUser.name)}</h3><div style="color:var(--muted)">${escapeHtml(sessionUser.major||'â€”')}</div><hr><div><strong>ReputaciÃ³n: </strong>${sessionUser.reputation} pts</div><div style="margin-top:8px"><strong>Tus temas publicados:</strong><ul>${userThreads.map(t=>'<li>'+escapeHtml(t.title)+'</li>').join('')}</ul></div><div style="display:flex;justify-content:flex-end;margin-top:12px"><button class="btn" id="closeProf">Cerrar</button></div>`;
Â  Â  Â  box.querySelector('#closeProf').onclick = ()=>{ modal.style.display='none'; }
Â  Â  }

Â  Â  // theme toggle
Â  Â  byId('themeToggle').onclick = ()=>{
Â  Â  Â  if(document.documentElement.classList.contains('dark')){
Â  Â  Â  Â  document.documentElement.classList.remove('dark');
Â  Â  Â  Â  localStorage.setItem(THEME_KEY,'light');
Â  Â  Â  Â  byId('themeToggle').textContent = 'ðŸŒ™';
Â  Â  Â  } else {
Â  Â  Â  Â  document.documentElement.classList.add('dark');
Â  Â  Â  Â  localStorage.setItem(THEME_KEY,'dark');
Â  Â  Â  Â  byId('themeToggle').textContent = 'â˜€ï¸';
Â  Â  Â  }
Â  Â  };

    /* === [NUEVO] LÃ³gica para el botÃ³n de filtro A11y === */
    byId('a11yFilterBtn').onclick = ()=>{
        const html = document.documentElement;
        const current = html.dataset.cbf;
        let nextState;
        
        if(current === 'protan') nextState = 'deutan';
        else if(current === 'deutan') nextState = 'tritan';
        else if(current === 'tritan') nextState = 'none';
        else nextState = 'protan'; // Inicia el ciclo

        const btn = byId('a11yFilterBtn');
        if(nextState === 'none'){
            delete html.dataset.cbf;
            localStorage.removeItem(A11Y_KEY);
            btn.textContent = 'ðŸŽ¨';
            btn.title = 'Cambiar filtro de color';
        } else {
            html.dataset.cbf = nextState;
            localStorage.setItem(A11Y_KEY, nextState);
            btn.textContent = nextState.charAt(0).toUpperCase(); // P, D, T
            btn.title = `Filtro actual: ${nextState}`;
        }
        // Forzamos un re-renderizado de los hilos para que los estilos de botones se actualicen
        // (ya que .btn.ghost hereda el color de --accent-brown)
        renderThreads(currentFilter, byId('searchBox').value);
    };

Â  Â  // close modal by clicking backdrop
Â  Â  document.querySelectorAll('.modal-back').forEach(m=>m.onclick = e=>{ if(e.target===m) m.style.display='none'; });

Â  Â  // text-to-speech helper
Â  Â  function speak(text){
Â  Â  Â  if(!('speechSynthesis' in window)){ alert('Tu navegador no soporta SpeechSynthesis'); return; }
Â  Â  Â  window.speechSynthesis.cancel();
Â  Â  Â  const u = new SpeechSynthesisUtterance(text);
Â  Â  Â  u.lang = 'es-ES';
Â  Â  Â  window.speechSynthesis.speak(u);
Â  Â  }

Â  Â  // helpers
Â  Â  let currentFilter = 'all';

Â  Â  // initialize
Â  Â  initTheme();
    initA11yFilter(); /* === [NUEVO] Cargar filtro A11y guardado === */
Â  Â  renderTop();
Â  Â  renderThreads('all','');
Â  Â  updateSessionUI();

Â  Â  // Optional: allow logo replacement at runtime if LOGO_BASE64 provided elsewhere
Â  Â  // Example to replace logo: document.getElementById('siteLogo').src = 'data:image/png;base64,' + LOGO_BASE64;
Â  </script>
</body>
</html>
